<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransportPro - Fleet Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --background: #f8fafc;
            --sidebar: #1e293b;
            --text: #0f172a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--background);
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            background-color: #1a1a1d;
            color: #f0f0f0;
            width: 250px;
            height: 100vh;
            position: fixed;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            text-align: center;
        }

        .logo i {
            color: #798de6;
            margin-right: 10px;
            font-size: 1.5em;
        }

        .logo h1 {
            font-size: 1.4em;
            font-weight: bold;
            color: #fff;
            margin: 0;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.1em;
            background: none;
            border: none;
            color: #f0f0f0;
            padding: 15px;
            cursor: pointer;
            width: 100%;
            text-align: left;
            transition: background-color 0.3s;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 2rem;
            background: var(--background);
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card h3 {
            margin-bottom: 1rem;
            color: var(--text);
            font-size: 1.25rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .table th,
        .table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .table th {
            background: var(--background);
            font-weight: 500;
            color: var(--secondary);
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-success {
            background: #dcfce7;
            color: #166534;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .stat-card h4 {
            color: var(--secondary);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text);
        }

        .validation-error {
            color: var(--danger);
            font-size: 0.875rem;
            margin-top: -0.5rem;
            margin-bottom: 0.5rem;
        }

        #tripChart {
            max-width: 400px;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <aside class="sidebar">
        <div class="logo">
            <i class="fas fa-truck fa-lg"></i>
            <h1>TransportPro</h1>
        </div>
        <ul class="nav-menu">
            <li>
                <button class="nav-link" onclick="showPage('registerPage')" aria-label="Register">
                    <i class="fas fa-route"></i>
                    <span>Register</span>
                </button>
            </li>
            <li>
                <button class="nav-link" onclick="showPage('authPage')" aria-label="Login">
                    <i class="fas fa-route"></i>
                    <span>Login</span>
                </button>
            </li>
            <li>
                <button class="nav-link active" onclick="showPage('dashboard')" aria-label="Dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </button>
            </li>
            <li>
                <button class="nav-link" onclick="showPage('vehicles')" aria-label="Vehicles">
                    <i class="fas fa-truck"></i>
                    <span>Vehicles</span>
                </button>
            </li>
            <li>
                <button class="nav-link" onclick="showPage('drivers')" aria-label="Drivers">
                    <i class="fas fa-user"></i>
                    <span>Drivers</span>
                </button>
            </li>
            <li>
                <button class="nav-link" onclick="showPage('trips')" aria-label="Trips">
                    <i class="fas fa-route"></i>
                    <span>Trips</span>
                </button>
            </li>
            <li>
                <button class="nav-link" onclick="showPage('searchFilter')" aria-label="Search & Filters">
                    <i class="fas fa-route"></i>
                    <span>Search & Filters</span>
                </button>
            </li>

        </ul>
    </aside>

    <main class="main-content">
        <div id="dashboard" class="page active">
            <h2>DASHBOARD</h2>
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h4>Total Vehicles</h4>
                    <div class="value" id="totalVehicles">0</div>
                </div>
                <div class="stat-card">
                    <h4>Active Drivers</h4>
                    <div class="value" id="totalDrivers">0</div>
                </div>
                <div class="stat-card">
                    <h4>Total Trips</h4>
                    <div class="value" id="totalTrips">0</div>
                </div>
                <div class="stat-card">
                    <h4>Today's Trips</h4>
                    <div class="value" id="todayTrips">0</div>
                </div>
            </div>
            <h2>Reports & Analytics</h2>
            <div class="card">
                <h3>Trip Statistics</h3>
                <canvas id="tripChart"></canvas>
            </div>
        </div>
        <div id="authPage" class="page">
            <h2>Login</h2>
            <form id="loginForm" onsubmit="authenticateUser(event)">
                <div class="form-group">
                    <input type="text" class="form-control" id="username" placeholder="Username" required>
                </div>
                <div class="form-group">
                    <input type="password" class="form-control" id="password" placeholder="Password" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
            </form>
            <p id="authError" class="validation-error"></p>
        </div>
        <div id="registerPage" class="page">
            <h2>Register</h2>
            <form id="registerForm" onsubmit="registerUser(event)">
                <div class="form-group">
                    <input type="text" class="form-control" id="regUsername" placeholder="Username" required>
                </div>
                <div class="form-group">
                    <input type="password" class="form-control" id="regPassword" placeholder="Password" required>
                </div>
                <button type="submit" class="btn btn-primary">Register</button>
            </form>
            <p id="regError" class="validation-error"></p>
        </div>



        <div id="vehicles" class="page">
            <div class="card">
                <h3>Add New Vehicle</h3>
                <form id="vehicleForm" onsubmit="addVehicle(event)">
                    <div class="form-group">
                        <input type="text" class="form-control" id="vehicleName" placeholder="Vehicle Name" required>
                        <div class="validation-error" id="vehicleNameError"></div>
                    </div>
                    <div class="form-group">
                        <select class="form-control" id="vehicleType" required>
                            <option value="">Select Vehicle Type</option>
                            <option>Truck</option>
                            <option>Van</option>
                            <option>Bus</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control" id="vehicleLicense" placeholder="License Plate"
                            required>
                        <div class="validation-error" id="vehicleLicenseError"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Vehicle
                    </button>
                </form>
            </div>
            <div class="card">
                <h3>Vehicle List</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Vehicle</th>
                            <th>Type</th>
                            <th>License Plate</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="vehicleTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="drivers" class="page">
            <div class="card">
                <h3>Add New Driver</h3>
                <form id="driverForm" onsubmit="addDriver(event)">
                    <div class="form-group">
                        <input type="text" class="form-control" id="driverName" placeholder="Driver Name" required>
                        <div class="validation-error" id="driverNameError"></div>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control" id="driverLicense" placeholder="License Number"
                            required>
                        <div class="validation-error" id="driverLicenseError"></div>
                    </div>
                    <div class="form-group">
                        <input type="tel" class="form-control" id="driverContact" placeholder="Contact Number" required>
                        <div class="validation-error" id="driverContactError"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Driver
                    </button>
                </form>
            </div>
            <div class="card">
                <h3>Driver List</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Driver</th>
                            <th>License</th>
                            <th>Contact</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="driverTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="trips" class="page">
            <div class="card">
                <h3>Schedule New Trip</h3>
                <form id="tripForm" onsubmit="scheduleTrip(event)">
                    <div class="form-group">
                        <input type="text" class="form-control" id="tripRoute" placeholder="Route" required>
                        <div class="validation-error" id="tripRouteError"></div>
                    </div>
                    <div class="form-group">
                        <input type="date" class="form-control" id="tripDate" required>
                        <div class="validation-error" id="tripDateError"></div>
                    </div>
                    <div class="form-group">
                        <input type="time" class="form-control" id="tripTime" required>
                        <div class="validation-error" id="tripTimeError"></div>
                    </div>
                    <div class="form-group">
                        <select class="form-control" id="tripDriver" required>
                            <option value="">Select Driver</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <select class="form-control" id="tripVehicle" onchange="updateVehicleDetails()" required>
                            <option value="">Select Vehicle</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control" id="tripVehicleType" placeholder="Vehicle Type"
                            readonly>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control" id="tripLicensePlate" placeholder="License Plate"
                            readonly>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Schedule Trip
                    </button>
                </form>
            </div>
            <div class="card">
                <h3>Trip List</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Route</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Driver</th>
                            <th>Vehicle</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tripTableBody"></tbody>
                </table>
            </div>
        </div>
        <div id="searchFilter" class="page">
            <h2>Search & Filters</h2>
            <div class="card">
                <select id="searchDriver" class="form-control">
                    <option value="">Select Driver</option>
                </select>
                <select id="searchVehicle" class="form-control">
                    <option value="">Select Vehicle</option>
                </select>
                <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
            </div>
            <div class="card">
                <h3>Results</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Route</th>
                            <th>Driver</th>
                            <th>Vehicle</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTable"></tbody>
                </table>
            </div>
        </div>



    </main>

    <script>

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            updateDashboard();
            setMinDate();
            renderChart();
        });

        // Utility Functions
        function showNotification(message, type = 'success') {
            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: 'right',
                backgroundColor: type === 'success' ? '#22c55e' : '#ef4444'
            }).showToast();
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function setMinDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tripDate').min = today;
        }

        // Data Management Functions
        function loadData() {
            loadVehicles();
            loadDrivers();
            loadTrips();
        }

        function updateDashboard() {
            const vehicles = JSON.parse(sessionStorage.getItem('vehicles')) || [];
            const drivers = JSON.parse(sessionStorage.getItem('drivers')) || [];
            const trips = JSON.parse(sessionStorage.getItem('trips')) || [];
            const today = new Date().toISOString().split('T')[0];

            console.log('Stored trips:', trips); // Log all trips
            console.log('Today:', today);        // Log today's date

            document.getElementById('totalVehicles').textContent = vehicles.length;
            document.getElementById('totalDrivers').textContent = drivers.length;
            document.getElementById('totalTrips').textContent = trips.length;

            const todayTripsCount = trips.filter(trip => {
                console.log(`Comparing trip date: ${trip.date} with today: ${today}`);
                return trip.date === today;
            }).length;

            document.getElementById('todayTrips').textContent = todayTripsCount;
        }



        // Vehicle Management
        function addVehicle(event) {
            event.preventDefault();

            const name = document.getElementById('vehicleName').value.trim();
            const type = document.getElementById('vehicleType').value;
            const license = document.getElementById('vehicleLicense').value.trim().toUpperCase();

            // Clear previous errors
            document.getElementById('vehicleNameError').textContent = '';
            document.getElementById('vehicleLicenseError').textContent = '';

            // Validation
            if (name.length < 2) {
                document.getElementById('vehicleNameError').textContent = 'Name must be at least 2 characters';
                return;
            }

            if (!license.match(/^[A-Z0-9]{4,10}$/)) {
                document.getElementById('vehicleLicenseError').textContent = 'Invalid license plate format';
                return;
            }

            const vehicles = JSON.parse(sessionStorage.getItem('vehicles')) || [];

            // Check for duplicate license plate
            if (vehicles.some(v => v.license === license)) {
                document.getElementById('vehicleLicenseError').textContent = 'License plate already exists';
                return;
            }

            vehicles.push({
                id: Date.now(),
                name,
                type,
                license,
                status: 'Active'
            });

            sessionStorage.setItem('vehicles', JSON.stringify(vehicles));
            document.getElementById('vehicleForm').reset();
            loadVehicles();
            updateDashboard();
            showNotification('Vehicle added successfully');
        }

        function loadVehicles() {
            const vehicles = JSON.parse(sessionStorage.getItem('vehicles')) || [];
            const tableBody = document.getElementById('vehicleTableBody');

            tableBody.innerHTML = vehicles.map(v => `
        <tr>
            <td>${v.name}</td>
            <td>${v.type}</td>
            <td>${v.license}</td>
            <td><span class="badge badge-success">${v.status}</span></td>
            <td>
                <button class="btn btn-danger" onclick="deleteVehicle(${v.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        </tr>
    `).join('');

            // Update vehicle select in trips form
            const vehicleSelect = document.getElementById('tripVehicle');
            vehicleSelect.innerHTML = '<option value="">Select Vehicle</option>' +
                vehicles.map(v => `<option value="${v.id}">${v.name} (${v.type})</option>`).join('');
        }

        function deleteVehicle(id) {
            if (!confirm('Are you sure you want to delete this vehicle?')) return;

            const vehicles = JSON.parse(sessionStorage.getItem('vehicles')) || [];
            const trips = JSON.parse(sessionStorage.getItem('trips')) || [];

            // Check if vehicle is assigned to any future trips
            const today = new Date().toISOString().split('T')[0];
            const hasActiveTrips = trips.some(trip =>
                trip.vehicleId === id && trip.date >= today
            );

            if (hasActiveTrips) {
                showNotification('Cannot delete vehicle with active trips', 'error');
                return;
            }

            const updatedVehicles = vehicles.filter(v => v.id !== id);
            sessionStorage.setItem('vehicles', JSON.stringify(updatedVehicles));
            loadVehicles();
            updateDashboard();
            showNotification('Vehicle deleted successfully');
        }

        // Driver Management
        function addDriver(event) {
            event.preventDefault();

            const name = document.getElementById('driverName').value.trim();
            const license = document.getElementById('driverLicense').value.trim().toUpperCase();
            const contact = document.getElementById('driverContact').value.trim();

            // Clear previous errors
            document.getElementById('driverNameError').textContent = '';
            document.getElementById('driverLicenseError').textContent = '';
            document.getElementById('driverContactError').textContent = '';

            // Validation
            if (name.length < 3) {
                document.getElementById('driverNameError').textContent = 'Name must be at least 3 characters';
                return;
            }

            if (!license.match(/^[A-Z0-9]{5,12}$/)) {
                document.getElementById('driverLicenseError').textContent = 'Invalid license number format';
                return;
            }

            if (!contact.match(/^\+?[\d\s-]{10,15}$/)) {
                document.getElementById('driverContactError').textContent = 'Invalid contact number';
                return;
            }

            const drivers = JSON.parse(sessionStorage.getItem('drivers')) || [];

            // Check for duplicate license
            if (drivers.some(d => d.license === license)) {
                document.getElementById('driverLicenseError').textContent = 'License number already exists';
                return;
            }

            drivers.push({
                id: Date.now(),
                name,
                license,
                contact,
                status: 'Active'
            });

            sessionStorage.setItem('drivers', JSON.stringify(drivers));
            document.getElementById('driverForm').reset();
            loadDrivers();
            updateDashboard();
            showNotification('Driver added successfully');
        }

        function loadDrivers() {
            const drivers = JSON.parse(sessionStorage.getItem('drivers')) || [];
            const tableBody = document.getElementById('driverTableBody');

            tableBody.innerHTML = drivers.map(d => `
        <tr>
            <td>${d.name}</td>
            <td>${d.license}</td>
            <td>${d.contact}</td>
            <td><span class="badge badge-success">${d.status}</span></td>
            <td>
                <button class="btn btn-danger" onclick="deleteDriver(${d.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        </tr>
    `).join('');

            // Update driver select in trips form
            const driverSelect = document.getElementById('tripDriver');
            driverSelect.innerHTML = '<option value="">Select Driver</option>' +
                drivers.map(d => `<option value="${d.id}">${d.name}</option>`).join('');
        }

        function deleteDriver(id) {
            if (!confirm('Are you sure you want to delete this driver?')) return;

            const drivers = JSON.parse(sessionStorage.getItem('drivers')) || [];
            const trips = JSON.parse(sessionStorage.getItem('trips')) || [];

            // Check if driver is assigned to any future trips
            const today = new Date().toISOString().split('T')[0];
            const hasActiveTrips = trips.some(trip =>
                trip.driverId === id && trip.date >= today
            );

            if (hasActiveTrips) {
                showNotification('Cannot delete driver with active trips', 'error');
                return;
            }

            const updatedDrivers = drivers.filter(d => d.id !== id);
            sessionStorage.setItem('drivers', JSON.stringify(updatedDrivers));
            loadDrivers();
            updateDashboard();
            showNotification('Driver deleted successfully');
        }

        // Trip Management
        function updateVehicleDetails() {
            const vehicleId = document.getElementById('tripVehicle').value;
            const vehicles = JSON.parse(sessionStorage.getItem('vehicles')) || [];
            const vehicle = vehicles.find(v => v.id === Number(vehicleId));

            if (vehicle) {
                document.getElementById('tripVehicleType').value = vehicle.type;
                document.getElementById('tripLicensePlate').value = vehicle.license;
            } else {
                document.getElementById('tripVehicleType').value = '';
                document.getElementById('tripLicensePlate').value = '';
            }
        }

        function scheduleTrip(event) {
            event.preventDefault();

            const route = document.getElementById('tripRoute').value.trim();
            const date = document.getElementById('tripDate').value; // Input is already YYYY-MM-DD
            const time = document.getElementById('tripTime').value;
            const driverId = document.getElementById('tripDriver').value;
            const vehicleId = document.getElementById('tripVehicle').value;

            // Clear previous errors
            document.getElementById('tripRouteError').textContent = '';
            document.getElementById('tripDateError').textContent = '';
            document.getElementById('tripTimeError').textContent = '';

            // Validation
            if (!route || !date || !time || !driverId || !vehicleId) {
                showNotification('All fields are required', 'error');
                return;
            }

            const trips = JSON.parse(sessionStorage.getItem('trips')) || [];

            trips.push({
                id: Date.now(),
                route,
                date: new Date(date).toISOString().split('T')[0], // Ensure consistency
                time,
                driverId: Number(driverId),
                vehicleId: Number(vehicleId),
                status: 'Scheduled',
            });

            sessionStorage.setItem('trips', JSON.stringify(trips));
            loadTrips();
            updateDashboard();
            showNotification('Trip scheduled successfully', 'success');
            renderChart();
        }


        function loadTrips() {
            const trips = JSON.parse(sessionStorage.getItem('trips')) || [];
            const drivers = JSON.parse(sessionStorage.getItem('drivers')) || [];
            const vehicles = JSON.parse(sessionStorage.getItem('vehicles')) || [];
            const tableBody = document.getElementById('tripTableBody');

            tableBody.innerHTML = trips.map(t => {
                const driver = drivers.find(d => d.id === t.driverId);
                const vehicle = vehicles.find(v => v.id === t.vehicleId);

                return `
            <tr>
                <td>${t.route}</td>
                <td>${t.date}</td>
                <td>${t.time}</td>
                <td>${driver ? driver.name : 'Unknown'}</td>
                <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                <td><span class="badge badge-warning">${t.status}</span></td>
                <td>
                    <button class="btn btn-danger" onclick="deleteTrip(${t.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;
            }).join('');
        }

        function deleteTrip(id) {
            if (!confirm('Are you sure you want to delete this trip?')) return;

            const trips = JSON.parse(sessionStorage.getItem('trips')) || [];
            const today = new Date().toISOString().split('T')[0];
            const trip = trips.find(t => t.id === id);

            if (trip && trip.date < today) {
                showNotification('Cannot delete past trips', 'error');
                return;
            }

            const updatedTrips = trips.filter(t => t.id !== id);
            sessionStorage.setItem('trips', JSON.stringify(updatedTrips));
            loadTrips();
            updateDashboard();
            showNotification('Trip deleted successfully');
        }
        function authenticateUser(event) {
            event.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            // Example hardcoded roles (replace with backend API integration)
            const users = {
                admin: { password: 'admin123', role: 'Admin' },
                driver: { password: 'driver123', role: 'Driver' },
            };

            if (users[username] && users[username].password === password) {
                sessionStorage.setItem('role', users[username].role);
                showNotification('Login successful', 'success');
                showPage('dashboard');
            } else {
                document.getElementById('authError').textContent = 'Invalid username or password';
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            if (document.getElementById('tripChart')) renderChart();
        });

        function renderChart() {
            const trips = JSON.parse(sessionStorage.getItem('trips')) || [];
            const statusCounts = trips.reduce((counts, trip) => {
                counts[trip.status] = (counts[trip.status] || 0) + 1;
                return counts;
            }, {});

            // Extract data for the chart
            const scheduled = statusCounts['Scheduled'] || 0;
            const completed = statusCounts['Completed'] || 0;
            const cancelled = statusCounts['Cancelled'] || 0;

            const ctx = document.getElementById('tripChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Scheduled', 'Completed', 'Cancelled'],
                    datasets: [{
                        label: 'Trip Status',
                        data: [scheduled, completed, cancelled],
                        backgroundColor: ['#2563eb', '#22c55e', '#ef4444'],
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        function applyFilters() {
    const selectedDriver = document.getElementById('searchDriver').value;
    const selectedVehicle = document.getElementById('searchVehicle').value;

    const trips = JSON.parse(sessionStorage.getItem('trips')) || [];
    const drivers = JSON.parse(sessionStorage.getItem('drivers')) || [];
    const vehicles = JSON.parse(sessionStorage.getItem('vehicles')) || [];

    // Filter trips based on selected driver and vehicle
    const filteredTrips = trips.filter(trip =>
        (!selectedDriver || trip.driverId === Number(selectedDriver)) &&
        (!selectedVehicle || trip.vehicleId === Number(selectedVehicle))
    );

    // Populate the results table
    const resultsTable = document.getElementById('resultsTable');
    resultsTable.innerHTML = filteredTrips.map(trip => {
        const driver = drivers.find(d => d.id === trip.driverId);
        const vehicle = vehicles.find(v => v.id === trip.vehicleId);

        return `
            <tr>
                <td>${trip.route}</td>
                <td>${driver ? driver.name : 'Unknown'}</td>
                <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                <td>${trip.status}</td>
            </tr>
        `;
    }).join('');

    // Handle case where no results are found
    if (filteredTrips.length === 0) {
        resultsTable.innerHTML = `
            <tr>
                <td colspan="4" style="text-align: center;">No results found</td>
            </tr>
        `;
    }
}




        function registerUser(event) {
            event.preventDefault();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value.trim();

            let users = JSON.parse(localStorage.getItem('users')) || [];
            if (users.some(user => user.username === username)) {
                document.getElementById('regError').textContent = 'Username already exists';
                return;
            }

            users.push({ username, password });
            localStorage.setItem('users', JSON.stringify(users));
            showNotification('Registration successful', 'success');
            showPage('authPage');
        }

        function authenticateUser(event) {
            event.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            const users = JSON.parse(localStorage.getItem('users')) || [];
            if (users.some(user => user.username === username && user.password === password)) {
                sessionStorage.setItem('loggedIn', 'true');
                showNotification('Login successful', 'success');
                showPage('dashboard');
            } else {
                document.getElementById('authError').textContent = 'Invalid username or password';
            }
        }

        // Restrict access to dashboard and other pages
        document.addEventListener('DOMContentLoaded', () => {
            if (!sessionStorage.getItem('loggedIn')) showPage('authPage');
        });
        function showPage(pageId) {
            if (!sessionStorage.getItem('loggedIn') && pageId !== 'authPage' && pageId !== 'registerPage') {
                showNotification('You must log in first', 'error');
                return showPage('authPage');
            }
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }
        function loadTrips() {
            const trips = JSON.parse(sessionStorage.getItem('trips')) || [];
            const drivers = JSON.parse(sessionStorage.getItem('drivers')) || [];
            const vehicles = JSON.parse(sessionStorage.getItem('vehicles')) || [];
            const tableBody = document.getElementById('tripTableBody');

            tableBody.innerHTML = trips.map(trip => {
                const driver = drivers.find(d => d.id === trip.driverId);
                const vehicle = vehicles.find(v => v.id === trip.vehicleId);

                return `
            <tr>
                <td>${trip.route}</td>
                <td>${trip.date}</td>
                <td>${trip.time}</td>
                <td>${driver ? driver.name : 'Unknown'}</td>
                <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                <td>
                    <select onchange="updateTripStatus(${trip.id}, this.value)">
                        <option value="Scheduled" ${trip.status === 'Scheduled' ? 'selected' : ''}>Scheduled</option>
                        <option value="Completed" ${trip.status === 'Completed' ? 'selected' : ''}>Completed</option>
                        <option value="Cancelled" ${trip.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                    </select>
                </td>
                <td>
                    <button class="btn btn-danger" onclick="deleteTrip(${trip.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;
            }).join('');
        }

        function updateTripStatus(tripId, newStatus) {
            const trips = JSON.parse(sessionStorage.getItem('trips')) || [];
            const tripIndex = trips.findIndex(trip => trip.id === tripId);

            if (tripIndex !== -1) {
                trips[tripIndex].status = newStatus;
                sessionStorage.setItem('trips', JSON.stringify(trips));
                loadTrips();
                updateDashboard();
                renderChart(); // Refresh the chart
                showNotification(`Trip status updated to ${newStatus}`, 'success');
            }
        }
        function loadSearchFilters() {
            const drivers = JSON.parse(sessionStorage.getItem('drivers')) || [];
            const vehicles = JSON.parse(sessionStorage.getItem('vehicles')) || [];

            const driverDropdown = document.getElementById('searchDriver');
            const vehicleDropdown = document.getElementById('searchVehicle');

            driverDropdown.innerHTML = '<option value="">Select Driver</option>' +
                drivers.map(d => `<option value="${d.id}">${d.name}</option>`).join('');

            vehicleDropdown.innerHTML = '<option value="">Select Vehicle</option>' +
                vehicles.map(v => `<option value="${v.id}">${v.name} (${v.type})</option>`).join('');
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadSearchFilters();
        });




    </script>
</body>

</html>
